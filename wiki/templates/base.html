
{% load static %}
<!DOCTYPE html>
<html>
   <head>
      <meta charset="utf-8" />
      <title>Summary</title>
      <link rel="stylesheet" href="{% static 'css/main.css'%}">
      <link rel="stylesheet" href="{% static 'css/page.css'%}">
      <script type="text/javascript" src="https://code.jquery.com/jquery-3.5.0.min.js"></script>
      <script type="text/javascript" src="{% static 'js/main.js' %}"></script>
      
      <style>
         .page .favorit{
            position: relative;
            float: right;
            display: block;
            width: 30px;
            height: 30px;
            padding: 0px;
            margin-right: 10px;
            margin-top: 10px;
            cursor:pointer;
         }
      </style>
   </head>
   <body>
      <div class="hipanel"> <div class="back">{{titlepanel}}</div> 
            <div class="userp">
                  {% if user.is_authenticated %}
                        <li>Пользователь: {{ user.get_username }}</li>
                        <li><a href="{% url 'logout'%}?next={{request.path}}">Выйти</a></li>   
                  {% else %}
                        <li><a href="{% url 'login'%}?next={{request.path}}">Войти</a></li>   
                  {% endif %} 
            </div>
      </div>
      <div class="main" id="main">
         {% block content %}
            
         {% endblock %}
      </div>    
      <script>
          function getCookie(name) {
            var cookieValue = null;
            if (document.cookie && document.cookie !== '') {
               var cookies = document.cookie.split(';');
               for (var i = 0; i < cookies.length; i++) {
                     var cookie = jQuery.trim(cookies[i]);
                     // Does this cookie string begin with the name we want?
                     if (cookie.substring(0, name.length + 1) === (name + '=')) {
                        cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                        break;
                     }
               }
            }
            return cookieValue;
         }
         main.onclick = function(event){
           event = event || window.event;           
           let img = event.target.closest('.favorit');
           console.log(img);
           if (img){

            $.ajax(
                  {
                     url: '/add_favorite/',
                     type: 'POST',
                     dataType: 'json',
                     data: {'id': img.alt, csrfmiddlewaretoken: getCookie('csrftoken')},
                     error: function () 
                           {
                              alert('Ошибка получения запроса')
                           },
                     success: function (data) 
                        {
                           console.log(data.result);
                                       let apply="{% static 'img/Star1.png'%}";                          
                                       let cancl="{% static 'img/Star2.png'%}";
                           img.src=(img.src!=data.result)? (cancl): (apply);
                        }
                  });
           }else{
            let page = event.target.closest('.page');
            if (page){
               let chield = page.querySelector('.title');
            $.ajax(
                  {
                     url: '/add_history/',
                     type: 'POST',
                     dataType: 'json',
                     data: {'id': chield.textContent, csrfmiddlewaretoken: getCookie('csrftoken')},
                     error: function () 
                           {
                              alert('Ошибка получения запроса')
                           },
                     success: function (data) 
                        {
                           let container = document.getElementById('main');
                           while (container.firstChild) {
                              container.removeChild(container.firstChild);
                           }
                           let div = document.createElement('div');
                           div.innerHTML = data.notifications_list
                           container.appendChild(div);
                        }
                  });
            }
            
           }
         }
     </script> 
      <ul class="nav">
          <li><a href="{% url 'main'%}">Главная</a></li>
          <li><a href="{% url 'favorit'%}">Избранное</a></li>
          <li><a href="{% url 'history'%}">История</a></li>
          <li><a href="{% url 'settings'%}">Настройки</a></li>
      </ul>
   </body>
</html>